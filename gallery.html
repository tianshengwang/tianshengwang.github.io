<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Gallery ‚Äî Places ¬∑ Tiansheng (Tian) Wang</title>
  <meta name="description" content="A map of places with photo albums (like iPhone Places).">

  <!-- Fonts + shared site styles -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/assets/styles.css?v=14">

  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="anonymous">
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
          integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin="anonymous"></script>

  <style>
    #map { height: 70vh; width: 100%; border:1px solid var(--border); border-radius:16px; overflow:hidden; background:var(--card); }
    .map-wrap { padding: 12px; background: var(--card); border:1px solid var(--border); border-radius:16px; }

    .leaflet-container { background: var(--card); color: var(--fg); }
    .leaflet-popup-content-wrapper, .leaflet-tooltip {
      background: var(--card); color: var(--fg); border:1px solid var(--border);
    }
    .leaflet-popup-content-wrapper { border-radius:12px; }
    .leaflet-popup-tip { background: var(--card); }

    .pop-preview { display:flex; gap:10px; align-items:center; }
    .pop-preview img {
      width:84px; height:56px; object-fit:cover; border-radius:8px; border:1px solid var(--border);
      flex:0 0 auto;
    }
    .pop-meta { display:flex; flex-direction:column; gap:4px; }
    .pop-title { margin:0; font-weight:700; }
    .pop-count { color:var(--muted); font-size:.9rem; margin:0; }
    .pop-open {
      margin-top:6px; display:inline-block; padding:8px 10px; border-radius:10px;
      border:1px solid var(--border); background:var(--card); color:var(--fg); text-decoration:none;
    }

    /* Lightbox modal */
    .lightbox {
      position:fixed; inset:0; backdrop-filter: blur(4px);
      background: color-mix(in srgb, var(--bg) 65%, transparent);
      display:none; align-items:center; justify-content:center; z-index:9999;
    }
    .lightbox.show { display:flex; }
    .lightbox-inner {
      max-width:min(1200px, 96vw);
      max-height:min(90vh, 900px);
      width:96vw; height:auto;
      background: var(--card); border:1px solid var(--border); border-radius:16px; padding:10px;
      display:grid; grid-template-rows: auto 1fr auto; gap:8px;
      box-shadow:0 24px 80px rgba(0,0,0,.45);
    }
    .lb-head { display:flex; justify-content:space-between; align-items:center; gap:10px; }
    .lb-title { font-weight:700; margin:0; }
    .lb-close {
      border:1px solid var(--border); background:var(--card); color:var(--fg);
      border-radius:10px; padding:10px 12px; cursor:pointer;
    }
    .lb-stage { position:relative; display:flex; align-items:center; justify-content:center; overflow:hidden; }
    .lb-stage img {
      max-width:100%; max-height:70vh; object-fit:contain; border-radius:12px; border:1px solid var(--border);
      touch-action:manipulation;
    }
    .lb-nav {
      position:absolute; top:50%; transform:translateY(-50%); z-index:2;
      width:48px; height:48px; border-radius:999px; border:1px solid var(--border);
      background:var(--card); color:var(--fg); display:flex; align-items:center; justify-content:center; cursor:pointer;
      box-shadow:0 8px 24px rgba(0,0,0,.25);
    }
    .lb-prev { left:10px; }
    .lb-next { right:10px; }
    .lb-caption { color: var(--muted); font-size:.95rem; text-align:center; padding:2px 4px; }
    @media (max-width: 900px){
      #map { height: 60vh; }
      .lb-stage img { max-height:60vh; }
    }
  </style>

  <link rel="icon" href="/images/favicon.jpg" sizes="32x32">
  <link rel="icon" type="image/svg+xml" href="/images/favicon.svg">
</head>
<body>

<header>
  <div class="container">
    <nav>
      <div class="brand"><a href="/index.html">Tiansheng (Tian) Wang</a></div>
      <div class="nav">
        <a href="/index.html#home">Home</a>
        <a href="/index.html#lab">Lab</a>
        <a href="/software.html">Software</a>
        <a href="/publications.html">Publications</a>
        <a href="/gallery.html" class="active">Gallery</a>
        <button id="themeToggle" class="toggle" aria-label="Toggle light/dark">üåô</button>
      </div>
    </nav>
  </div>
</header>

<main>
  <section class="reveal">
    <div class="container">
      <h1 style="margin-bottom:8px;">Gallery ‚Äî Places</h1>
      <p class="subtitle" style="margin-top:0;">Tap a marker ‚Üí ‚ÄúOpen album.‚Äù In the viewer, swipe or use ‚ü®/‚ü©.</p>

      <div class="map-wrap">
        <div id="map" aria-label="World map with photo locations"></div>
      </div>
    </div>
  </section>
</main>

<section id="contact" class="reveal">
  <div class="container">
    <h2>Contact</h2>
    <p><strong>Email:</strong> <a href="mailto:tianwang@uh.edu">tianwang@uh.edu</a> ¬∑ <strong>GitHub:</strong> <a href="https://github.com/tianshengwang" target="_blank">@tianshengwang</a></p>
    <p style="color:#7c869a">¬© <span id="year"></span> Tiansheng (Tian) Wang ‚Äî Built with vanilla HTML/CSS, animated blobs, and scroll-reveal ‚ú¶ Hosted on GitHub Pages.</p>
  </div>
</section>

<button id="toTop" class="toTop" aria-label="Back to top">‚Üë</button>

<!-- Shared JS -->
<script defer src="/assets/site.js"></script>

<!-- Page JS -->
<script>
  // Albums
  const ALBUMS = [
    { name:"Berlin", coords:[52.52,13.405], folder:"/gallery/Berlin/", photos:["lunch.jpg","2.jpg"], caption:"ICPE 2024." },
    { name:"Washington, DC", coords:[38.9072,-77.0369], folder:"/gallery/Washington/", photos:["monument.jpg","2.jpg"], caption:"DC moments." },
    { name:"Copenhagen", coords:[55.6761,12.5683], folder:"/gallery/Copenhagen/", photos:["mermaid.jpg","2.jpg"], caption:"ICPE 2022." }
  ];

  const full = (album, idx) => album.folder + album.photos[idx];

  // Map (enable mobile tap handling)
  const map = L.map('map', {
    worldCopyJump: true,
    scrollWheelZoom: true,
    tap: true,
    touchZoom: true
  }).setView([20, 0], 2);

  L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png', {
    maxZoom: 19, attribution: '&copy; OpenStreetMap & Carto'
  }).addTo(map);

  // Markers with POPUPS (mobile-friendly)
  const markers = [];
  ALBUMS.forEach((album, idx) => {
    const marker = L.marker(album.coords).addTo(map);

    const popHtml = `
      <div class="pop-preview">
        <img src="${full(album, 0)}" alt="${album.name} thumbnail" />
        <div class="pop-meta">
          <p class="pop-title">${album.name}</p>
          <p class="pop-count">${album.photos.length} photo${album.photos.length>1?'s':''}</p>
          <button class="pop-open" data-album="${idx}">Open album</button>
        </div>
      </div>
    `;
    marker.bindPopup(popHtml, { maxWidth: 320, closeButton: true });

    // When popup opens, wire up the button inside it
    marker.on('popupopen', (e) => {
      const btn = e.popup._contentNode.querySelector('.pop-open');
      if (btn) {
        btn.addEventListener('click', () => openLightbox(ALBUMS[+btn.dataset.album], 0), { once:true });
      }
    });

    markers.push(marker);
  });

  if (markers.length > 1) {
    const group = L.featureGroup(markers);
    map.fitBounds(group.getBounds().pad(0.25));
  }

  // Lightbox
  const lb = document.createElement('div');
  lb.className = 'lightbox';
  lb.innerHTML = `
    <div class="lightbox-inner" role="dialog" aria-modal="true" aria-label="Album viewer">
      <div class="lb-head">
        <h3 class="lb-title">Album</h3>
        <button class="lb-close" aria-label="Close">Close ‚úï</button>
      </div>
      <div class="lb-stage">
        <button class="lb-nav lb-prev" aria-label="Previous">‚ü®</button>
        <img alt="Album image" />
        <button class="lb-nav lb-next" aria-label="Next">‚ü©</button>
      </div>
      <div class="lb-caption"></div>
    </div>`;
  document.body.appendChild(lb);

  const lbTitle = lb.querySelector('.lb-title');
  const lbImg   = lb.querySelector('.lb-stage img');
  const lbPrev  = lb.querySelector('.lb-prev');
  const lbNext  = lb.querySelector('.lb-next');
  const lbClose = lb.querySelector('.lb-close');
  const lbCap   = lb.querySelector('.lb-caption');

  let currentAlbum = null;
  let currentIndex = 0;

  function renderLightbox() {
    if (!currentAlbum) return;
    lbTitle.textContent = currentAlbum.name;
    lbImg.src = full(currentAlbum, currentIndex);
    lbImg.alt = `${currentAlbum.name} ‚Äì image ${currentIndex+1}`;
    lbCap.textContent = `${currentAlbum.caption || ''}  (${currentIndex+1}/${currentAlbum.photos.length})`;
  }
  function openLightbox(album, startIndex) {
    currentAlbum = album;
    currentIndex = startIndex || 0;
    renderLightbox();
    lb.classList.add('show');
    document.body.style.overflow = 'hidden';
  }
  function closeLightbox() {
    lb.classList.remove('show');
    document.body.style.overflow = '';
  }
  function nextImg() {
    if (!currentAlbum) return;
    currentIndex = (currentIndex + 1) % currentAlbum.photos.length;
    renderLightbox();
  }
  function prevImg() {
    if (!currentAlbum) return;
    currentIndex = (currentIndex - 1 + currentAlbum.photos.length) % currentAlbum.photos.length;
    renderLightbox();
  }

  lbNext.addEventListener('click', nextImg);
  lbPrev.addEventListener('click', prevImg);
  lbClose.addEventListener('click', closeLightbox);
  lb.addEventListener('click', (e) => { if (e.target === lb) closeLightbox(); });

  // Keyboard (desktop) + swipe (mobile)
  document.addEventListener('keydown', (e) => {
    if (!lb.classList.contains('show')) return;
    if (e.key === 'Escape') closeLightbox();
    else if (e.key === 'ArrowRight') nextImg();
    else if (e.key === 'ArrowLeft') prevImg();
  });

  let startX = null;
  lbImg.addEventListener('touchstart', e => { startX = e.touches[0].clientX; }, { passive:true });
  lbImg.addEventListener('touchend', e => {
    if (startX === null) return;
    const dx = e.changedTouches[0].clientX - startX;
    if (Math.abs(dx) > 40) (dx > 0 ? prevImg() : nextImg());
    startX = null;
  }, { passive:true });
</script>
</body>
</html>


